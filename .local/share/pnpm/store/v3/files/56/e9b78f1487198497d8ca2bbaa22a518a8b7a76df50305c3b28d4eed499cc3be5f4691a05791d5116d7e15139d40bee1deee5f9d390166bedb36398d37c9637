{"version":3,"file":"index.esm.js","sources":["../src/components/Photo.styled.tsx","../src/components/Photo.tsx","../src/datastores/unsplash.ts","../src/components/UnsplashAssetSource.styled.tsx","../src/components/UnsplashAssetSource.tsx","../src/components/Icon.tsx","../src/index.ts"],"sourcesContent":["import { Card, Theme } from '@sanity/ui'\nimport styled from 'styled-components'\n\ntype SanityTheme = Theme['sanity']\n\ninterface Style {\n  studioTheme: SanityTheme\n}\n\nexport const Root = styled.div`\n  overflow: hidden;\n  background-origin: content-box;\n  background-repeat: no-repeat;\n  background-clip: border-box;\n  background-size: cover;\n  position: relative;\n  outline: none !important;\n  border: ${({ studioTheme }: Style) => `1px solid ${studioTheme.color.card.enabled.border}`};\n  box-sizing: content-box;\n  user-drag: none;\n\n  &:hover {\n    opacity: 0.85;\n  }\n\n  &:focus,\n  &:active {\n    border: 1px solid var(--input-border-color-focus);\n    box-shadow: inset 0 0 0 3px var(--input-border-color-focus);\n  }\n`\n\nexport const CreditLineLink = styled.a`\n  text-decoration: none;\n  cursor: pointer;\n`\n\nexport const CreditLine = styled(Card)`\n  ${({ theme }) => `\n     --creditline-fg: ${theme.sanity.color.card.enabled.fg};\n     --creditline-bg: ${theme.sanity.color.card.enabled.bg};\n   `};\n  user-drag: none;\n  position: absolute;\n  background-color: var(--creditline-bg);\n  bottom: 0;\n\n  [data-ui='Text'] {\n    color: var(--creditline-fg);\n  }\n`\n","import { Text, useTheme } from '@sanity/ui'\nimport React, { useCallback, useEffect, useRef } from 'react'\nimport { UnsplashPhoto } from '../types'\nimport { CreditLine, CreditLineLink, Root } from './Photo.styled'\n\ntype Props = {\n  data: UnsplashPhoto\n  width: number\n  height: number\n  onClick: (photo: UnsplashPhoto) => void\n  onKeyDown: (event: any) => void\n  active: boolean\n  onFocus: (photo: UnsplashPhoto) => void\n}\n\nconst UTM_SOURCE = 'sanity-plugin-asset-source-unsplash'\n\nexport default function Photo(props: Props) {\n  const { onClick, data, onKeyDown, onFocus, active, width, height } = props\n  const rootElm = useRef<HTMLDivElement>(null)\n  const prevActive = useRef<boolean>(false)\n\n  const handleClick = useCallback(() => {\n    onClick(data)\n  }, [onClick, data])\n\n  const handleCreditLineClicked = useCallback(\n    (event: any) => {\n      event.stopPropagation()\n      const url = `${data.links.html}?utm_source=${encodeURIComponent(\n        UTM_SOURCE\n      )}&utm_medium=referral`\n      window.open(url, data.id, 'noreferrer,noopener')\n    },\n    [data]\n  )\n\n  const handleKeyDown = useCallback(\n    (event: any) => {\n      onKeyDown(event)\n      if (event.keyCode === 13) {\n        onClick(data)\n      }\n    },\n    [onKeyDown, data, onClick]\n  )\n\n  const handleMouseDown = useCallback(() => {\n    onFocus(data)\n  }, [onFocus, data])\n\n  useEffect(() => {\n    if (!prevActive.current && active && rootElm.current) {\n      rootElm.current.focus()\n      onFocus(data)\n    }\n    prevActive.current = active\n    // data changing alone should not re-trigger effect\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [active])\n\n  const src = data.urls.small\n  const userName = data.user.name\n\n  const theme = useTheme().sanity\n  return (\n    <Root\n      ref={rootElm}\n      studioTheme={theme}\n      title={`Select image by ${userName} from Unsplash`}\n      tabIndex={0}\n      onKeyDown={handleKeyDown}\n      onMouseDown={handleMouseDown}\n      style={{\n        width: `${width}px`,\n        height: `${height}px`,\n        backgroundImage: `url(\"${src}\")`,\n      }}\n      onClick={handleClick}\n    >\n      <CreditLineLink onClick={handleCreditLineClicked}>\n        <CreditLine padding={2} radius={2} margin={2}>\n          <Text size={1} title={`Open image by ${userName} on Unsplash in new window`}>\n            By @{data.user.username}\n          </Text>\n        </CreditLine>\n      </CreditLineLink>\n    </Root>\n  )\n}\n","import { defer, concat, BehaviorSubject, Observable } from 'rxjs'\nimport { debounceTime, switchMap, map, distinctUntilChanged, withLatestFrom } from 'rxjs/operators'\nimport { UnsplashPhoto } from '../types'\nimport { SanityClient } from '@sanity/client'\n\ntype SearchSubject = BehaviorSubject<string>\ntype PageSubject = BehaviorSubject<number>\n\nconst fetchSearch = (\n  client: SanityClient,\n  query: string,\n  page: number,\n  perPage: number\n): Observable<any> =>\n  defer(\n    () =>\n      client.observable.request({\n        url: `/addons/unsplash/search/photos?query=${encodeURIComponent(\n          query\n        )}&page=${page}&per_page=${perPage}`,\n        withCredentials: true,\n        method: 'GET',\n      }) as any\n  )\n\nconst fetchList = (\n  client: SanityClient,\n  type: string,\n  page: number,\n  perPage: number\n): Observable<any> =>\n  defer(\n    () =>\n      client.observable.request({\n        url: `/addons/unsplash/photos?order_by=${type}&page=${page}&per_page=${perPage}`,\n        withCredentials: true,\n        method: 'GET',\n      }) as any\n  )\n\nexport function fetchDownloadUrl(client: SanityClient, photo: UnsplashPhoto): Promise<string> {\n  const downloadUrl = photo.links.download_location.replace(\n    'https://api.unsplash.com',\n    '/addons/unsplash'\n  )\n  return client\n    .request({\n      url: downloadUrl,\n      withCredentials: true,\n      method: 'GET',\n    })\n    .then((result: { url: string }) => {\n      return result.url\n    })\n}\n\nexport const search = (\n  client: SanityClient,\n  query: SearchSubject,\n  page: PageSubject,\n  resultsPerPage: number\n): Observable<any> => {\n  return concat(\n    query.pipe(\n      withLatestFrom(page),\n      debounceTime(500),\n      distinctUntilChanged(),\n      switchMap(([q, p]) => {\n        if (q) {\n          return fetchSearch(client, q, p, resultsPerPage).pipe(\n            distinctUntilChanged(),\n            map((result) => result.results)\n          )\n        }\n        return fetchList(client, 'popular', p, resultsPerPage)\n      })\n    )\n  )\n}\n","import { Stack } from '@sanity/ui'\nimport styled from 'styled-components'\n\nexport const Search = styled(Stack)`\n  position: sticky;\n  top: 0;\n  z-index: 1;\n`\n\nexport const Scroller = styled.div`\n  overflow-y: auto;\n  max-height: 80vh;\n`\n","import React from 'react'\nimport PhotoAlbum from 'react-photo-album'\nimport { BehaviorSubject, Subscription } from 'rxjs'\nimport { UnsplashPhoto } from '../types'\nimport Photo from './Photo'\nimport { fetchDownloadUrl, search } from '../datastores/unsplash'\nimport { Card, Dialog, Flex, Spinner, Stack, Text, TextInput } from '@sanity/ui'\nimport { Search } from './UnsplashAssetSource.styled'\nimport InfiniteScroll from 'react-infinite-scroll-component'\nimport { useClient, AssetSourceComponentProps, AssetFromSource } from 'sanity'\nimport { SanityClient } from '@sanity/client'\n\ntype State = {\n  query: string\n  searchResults: UnsplashPhoto[][]\n  page: number\n  isLoading: boolean\n  cursor: number\n}\n\nconst RESULTS_PER_PAGE = 42\nconst PHOTO_SPACING = 2\nconst PHOTO_PADDING = 1 // offset the 1px border width\n\nexport default function UnsplashAssetSource(props: AssetSourceComponentProps) {\n  const client = useClient({ apiVersion: '2022-09-01' })\n  return <UnsplashAssetSourceInternal {...props} client={client} />\n}\n\nclass UnsplashAssetSourceInternal extends React.Component<\n  AssetSourceComponentProps & { client: SanityClient },\n  State\n> {\n  static defaultProps = {\n    selectedAssets: undefined,\n  }\n\n  state = {\n    cursor: 0,\n    query: '',\n    page: 1,\n    searchResults: [[]],\n    isLoading: true,\n  }\n\n  searchSubscription: Subscription | null = null\n\n  searchSubject$ = new BehaviorSubject('')\n  pageSubject$ = new BehaviorSubject(1)\n\n  componentDidMount() {\n    this.searchSubscription = search(\n      this.props.client,\n      this.searchSubject$,\n      this.pageSubject$,\n      RESULTS_PER_PAGE\n    ).subscribe({\n      next: (results: UnsplashPhoto[]) => {\n        this.setState((prev) => ({\n          searchResults: [...prev.searchResults, results],\n          isLoading: false,\n        }))\n      },\n    })\n  }\n\n  componentWillUnmount() {\n    if (this.searchSubscription) {\n      this.searchSubscription.unsubscribe()\n    }\n  }\n\n  handleSelect = (photo: UnsplashPhoto) => {\n    this.setState({ isLoading: true })\n    return fetchDownloadUrl(this.props.client, photo).then((downloadUrl) => {\n      const description = photo.description || undefined\n      const asset: AssetFromSource = {\n        kind: 'url',\n        value: downloadUrl,\n        assetDocumentProps: {\n          _type: 'sanity.imageAsset',\n          source: {\n            name: 'unsplash',\n            id: photo.id,\n            url: photo.links.html,\n          },\n          description,\n          creditLine: `${photo.user.name} by Unsplash`,\n        } as any,\n      }\n      this.props.onSelect([asset])\n    })\n  }\n\n  handleClose = () => {\n    this.props.onClose()\n  }\n\n  handleSearchTermChanged = (event: React.ChangeEvent<HTMLInputElement>) => {\n    const query = event.currentTarget.value\n    this.setState({ query, page: 1, searchResults: [[]], isLoading: true, cursor: 0 })\n    this.pageSubject$.next(1)\n    this.searchSubject$.next(query)\n  }\n\n  handleScollerLoadMore = () => {\n    // eslint-disable-next-line react/no-access-state-in-setstate\n    const nextPage = this.state.page + 1\n    this.setState({ page: nextPage, isLoading: true })\n    this.pageSubject$.next(nextPage)\n    this.searchSubject$.next(this.state.query)\n  }\n\n  handleKeyDown = (event: any) => {\n    const { cursor } = this.state\n    if ((event.keyCode === 38 || event.keyCode === 37) && cursor > 0) {\n      this.setState((prevState) => ({\n        cursor: prevState.cursor - 1,\n      }))\n    } else if (\n      (event.keyCode === 40 || event.keyCode === 39) &&\n      cursor < this.getPhotos().length - 1\n    ) {\n      this.setState((prevState) => ({\n        cursor: prevState.cursor + 1,\n      }))\n    }\n  }\n\n  getPhotos() {\n    return this.state.searchResults.flat()\n  }\n\n  updateCursor = (photo: UnsplashPhoto) => {\n    const index = this.getPhotos().findIndex((result: UnsplashPhoto) => result.id === photo.id)\n    this.setState({ cursor: index })\n  }\n\n  renderImage = (props: any) => {\n    const { photo, layout } = props\n    const active =\n      this.getPhotos().findIndex((result: UnsplashPhoto) => result.id === photo.data.id) ===\n        this.state.cursor || false\n    return (\n      <Photo\n        onClick={this.handleSelect.bind(photo.data)}\n        onKeyDown={this.handleKeyDown}\n        data={photo.data}\n        width={layout.width}\n        height={layout.height}\n        active={active}\n        onFocus={this.updateCursor}\n      />\n    )\n  }\n\n  render() {\n    const { query, searchResults, isLoading } = this.state\n\n    return (\n      <Dialog\n        id=\"unsplash-asset-source\"\n        header=\"Select image from Unsplash\"\n        onClose={this.handleClose}\n        open\n        width={4}\n      >\n        <Stack space={3} padding={4}>\n          <Card>\n            <Search space={3}>\n              <Text size={1} weight=\"semibold\">\n                Search Unsplash\n              </Text>\n              <TextInput\n                label=\"Search Unsplash.com\"\n                placeholder=\"Topics or colors\"\n                value={query}\n                onChange={this.handleSearchTermChanged}\n              />\n            </Search>\n          </Card>\n          {!isLoading && this.getPhotos().length === 0 && (\n            <Text size={1} muted>\n              No results found\n            </Text>\n          )}\n          <InfiniteScroll\n            dataLength={this.getPhotos().length} // This is important field to render the next data\n            next={this.handleScollerLoadMore}\n            // scrollableTarget=\"unsplash-scroller\"\n            hasMore\n            scrollThreshold={0.99}\n            height=\"60vh\"\n            loader={\n              <Flex align=\"center\" justify=\"center\" padding={3}>\n                <Spinner muted />\n              </Flex>\n            }\n            endMessage={\n              <Text size={1} muted>\n                No more results\n              </Text>\n            }\n          >\n            {searchResults\n              .filter((photos) => photos.length > 0)\n              .map((photos: UnsplashPhoto[], index) => (\n                <PhotoAlbum\n                  key={`gallery-${query || 'popular'}-${index}`}\n                  layout=\"rows\"\n                  spacing={PHOTO_SPACING}\n                  padding={PHOTO_PADDING}\n                  targetRowHeight={(width) => {\n                    if (width < 300) return 150\n                    else if (width < 600) return 200\n                    return 300\n                  }}\n                  photos={photos.map((photo: UnsplashPhoto) => ({\n                    src: photo.urls.small,\n                    width: photo.width,\n                    height: photo.height,\n                    key: photo.id,\n                    data: photo,\n                  }))}\n                  renderPhoto={this.renderImage}\n                  componentsProps={{\n                    containerProps: { style: { marginBottom: `${PHOTO_SPACING}px` } },\n                  }}\n                />\n              ))}\n          </InfiniteScroll>\n        </Stack>\n      </Dialog>\n    )\n  }\n}\n","import React from 'react'\n\nexport default function UnsplashIcon() {\n  return (\n    <svg role=\"img\" viewBox=\"0 0 25 25\" width=\"1em\" height=\"1em\" fill=\"currentColor\">\n      <title />\n      <path d=\"M9 9V4h7v5H9Zm7 3h5v9H4v-9h5v5h7v-5Z\" />\n    </svg>\n  )\n}\n","import Unsplash from './components/UnsplashAssetSource'\nimport Icon from './components/Icon'\nimport { definePlugin, AssetSource } from 'sanity'\n\nexport type { UnsplashPhoto, Asset, AssetDocument } from './types'\n\n/**\n * @public\n */\nexport const unsplashAssetSource: AssetSource = {\n  name: 'unsplash',\n  title: 'Unsplash',\n  component: Unsplash,\n  icon: Icon,\n}\n\n/**\n * @public\n */\nexport const unsplashImageAsset = definePlugin({\n  name: 'asset-source-unsplash-plugin',\n\n  form: {\n    image: {\n      assetSources: (prev) => {\n        return [...prev, unsplashAssetSource]\n      },\n    },\n  },\n})\n"],"names":["Root","styled","div","studioTheme","color","card","enabled","border","CreditLineLink","a","CreditLine","Card","theme","sanity","fg","bg","UTM_SOURCE","Photo","props","onClick","data","onKeyDown","onFocus","active","width","height","rootElm","useRef","prevActive","handleClick","useCallback","handleCreditLineClicked","event","stopPropagation","url","links","html","encodeURIComponent","window","open","id","handleKeyDown","keyCode","handleMouseDown","useEffect","current","focus","src","urls","small","userName","user","name","useTheme","jsx","ref","title","tabIndex","onMouseDown","style","backgroundImage","children","padding","radius","margin","jsxs","Text","size","username","fetchSearch","client","query","page","perPage","defer","observable","request","withCredentials","method","fetchList","type","fetchDownloadUrl","photo","downloadUrl","download_location","replace","then","result","search","resultsPerPage","concat","pipe","withLatestFrom","debounceTime","distinctUntilChanged","switchMap","q","p","map","results","Search","Stack","RESULTS_PER_PAGE","PHOTO_SPACING","PHOTO_PADDING","UnsplashAssetSource","useClient","apiVersion","UnsplashAssetSourceInternal","React","Component","constructor","arguments","state","cursor","searchResults","isLoading","searchSubscription","searchSubject$","BehaviorSubject","pageSubject$","handleSelect","setState","description","asset","kind","value","assetDocumentProps","_type","source","creditLine","onSelect","handleClose","onClose","handleSearchTermChanged","currentTarget","next","handleScollerLoadMore","nextPage","prevState","getPhotos","length","updateCursor","index","findIndex","renderImage","layout","bind","componentDidMount","subscribe","prev","componentWillUnmount","unsubscribe","flat","render","Dialog","header","space","weight","TextInput","label","placeholder","onChange","muted","InfiniteScroll","dataLength","hasMore","scrollThreshold","loader","Flex","align","justify","Spinner","endMessage","filter","photos","PhotoAlbum","spacing","targetRowHeight","key","renderPhoto","componentsProps","containerProps","marginBottom","defaultProps","selectedAssets","UnsplashIcon","role","viewBox","fill","d","unsplashAssetSource","component","Unsplash","icon","Icon","unsplashImageAsset","definePlugin","form","image","assetSources"],"mappings":"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"}